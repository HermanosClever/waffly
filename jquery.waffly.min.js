(function(e){e.fn.waffly=function(t){var n,r,i,s,o,u,a,f,l,c=e.extend({class_name:"waffly",style_override:!1,default_color:"",graph_font:"arial, sans-serif",graph_title_color:"#666",graph_value_color:"#05c",graph_color:"#05c",graph_value:"80%",graph_margin:"30px",graph_class:"sel",total_dots:100,graph_width:250,dot_row:10,dot_gap:3,dot_radius:"20%",dot_opacity:".5",graph_reverse:!1,graph_animate:!0},t);this.each(function(){e(this).data("waffly-value")?c.graph_value=e(this).data("waffly-value").replace(",","."):c.graph_value=c.graph_value.replace(",",".");if(c.graph_value.indexOf(".")>-1){o=c.graph_value.split(".");o[1].length>3&&(c.graph_value=parseFloat(c.graph_value).toFixed(2)+"%")}i='<div class="'+c.class_name+'" style="-webkit-box-sizing: border-box;-moz-box-sizing: border-box;box-sizing: border-box;font-family:'+c.graph_font+";padding:"+c.graph_margin+";width:"+c.graph_width+'px;" title="'+e(this).text()+'">';i+='<div class="waffly_value" style="color:'+c.graph_value_color+';font-size:2.5em;font-weight:bold;margin:.5em 0 .25em;text-align:center">'+c.graph_value+"</div>";l=Math.floor((c.graph_width-parseInt(c.graph_margin)*2-(c.dot_row-1)*c.dot_gap)/c.dot_row);i+='<ul class="waffly_dots" style="font-size:0;list-style:none;margin:0;padding:0;">';f="";f+="border-radius:"+c.dot_radius+";";f+="display:inline-block;";f+="height:"+l+"px;";f+="margin:0 "+c.dot_gap+"px "+c.dot_gap+"px 0;";f+="width:"+l+"px;";opacity_styles="";if(c.default_color===""){u=c.graph_color;opacity_styles+="-ms-filter: 'progid:DXImageTransform.Microsoft.Alpha(Opacity="+c.dot_opacity*100+")';";opacity_styles+="filter: alpha(opacity="+c.dot_opacity*100+");";opacity_styles+="-moz-opacity: "+c.dot_opacity+";";opacity_styles+="-khtml-opacity: "+c.dot_opacity+";";opacity_styles+="opacity:"+c.dot_opacity+";"}else u=c.default_color;for(var t=0;t<c.total_dots;t++)t<parseInt(c.graph_value)?c.graph_animate?i+='<li class="waffly_dot d'+(t+1)+" "+c.graph_class+'" style="background:'+u+";"+f+opacity_styles+'"></li>':i+='<li class="waffly_dot d'+(t+1)+" "+c.graph_class+'" style="background:'+c.graph_color+";"+f+'"></li>':i+='<li class="waffly_dot d'+(t+1)+'" style="background:'+u+";"+f+opacity_styles+'"></li>';i+="</ul>";e(this).data("waffly-title")&&(i+='<div class="waffly_title" style="color:'+c.graph_title_color+';margin-top:.75em;text-align:center">'+e(this).data("waffly-title")+"</div>");i+="</div>";e(this).html(i);c.graph_reverse&&e(this).find(".waffly_dots").append(e(this).find(".waffly_dot").get().reverse());n=e(this).find(".waffly_dot.sel");c.graph_animate&&(c.graph_reverse?e(this).find(".waffly_dot.sel").each(function(e,t){var r=n.eq(Math.abs(e-n.length+1));setTimeout(function(){r.animate({opacity:1},10)},500+e*20)}):e(this).find(".waffly_dot.sel").each(function(t,n){setTimeout(function(){e(n).animate({opacity:1},10)},500+t*20)}))});return this}})(jQuery);